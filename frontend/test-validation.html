<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSV Validation Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .csv-content {
        background: #f5f5f5;
        padding: 10px;
        border-radius: 3px;
        font-family: monospace;
        white-space: pre-wrap;
        margin: 10px 0;
      }
      .error {
        color: #dc3545;
        font-weight: bold;
      }
      .success {
        color: #28a745;
        font-weight: bold;
      }
      .warning {
        color: #ffc107;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>CSV Validation Test</h1>

    <div class="test-section">
      <h2>Test Case: bad_port.csv (Missing Headers)</h2>
      <div class="csv-content">SPY,0.8 BND,0.2</div>

      <h3>Expected Behavior:</h3>
      <ul>
        <li class="error">❌ Should fail validation (missing headers)</li>
        <li class="error">❌ Should NOT make API call to backend</li>
        <li class="success">✅ Should show validation error message</li>
        <li class="success">✅ Should offer download sample CSV</li>
        <li class="success">✅ Should offer manual entry option</li>
      </ul>

      <h3>Steps to Test:</h3>
      <ol>
        <li>Go to the main application</li>
        <li>Switch to the "CSV" tab</li>
        <li>Upload the bad_port.csv file</li>
        <li>Verify that validation errors are shown</li>
        <li>Verify that no API call is made (check browser network tab)</li>
        <li>Verify that "Predict Volatility" button is not shown</li>
      </ol>
    </div>

    <div class="test-section">
      <h2>Test Case: Valid CSV with Headers</h2>
      <div class="csv-content">Ticker,Weight SPY,40 QQQ,30 VTI,30</div>

      <h3>Expected Behavior:</h3>
      <ul>
        <li class="success">✅ Should pass validation</li>
        <li class="success">✅ Should show "Predict Volatility" button</li>
        <li class="success">✅ Should allow API call when button is clicked</li>
      </ul>
    </div>

    <div class="test-section">
      <h2>Test Case: CSV with Weights ≠ 100%</h2>
      <div class="csv-content">Ticker,Weight SPY,40 QQQ,30 VTI,25</div>

      <h3>Expected Behavior:</h3>
      <ul>
        <li class="warning">
          ⚠️ Should show warning about weights not adding to 100%
        </li>
        <li class="success">✅ Should still allow proceeding</li>
        <li class="success">✅ Should offer manual entry option</li>
      </ul>
    </div>

    <div class="test-section">
      <h2>Test Case: Invalid File Type</h2>
      <div class="csv-content">This is a text file SPY 40% QQQ 30%</div>

      <h3>Expected Behavior:</h3>
      <ul>
        <li class="error">❌ Should fail validation (not CSV format)</li>
        <li class="error">❌ Should NOT make API call</li>
        <li class="success">✅ Should show clear error message</li>
      </ul>
    </div>

    <script>
      // Simple validation test
      function testValidation() {
        const badCsv = `SPY,0.8
BND,0.2`;

        const goodCsv = `Ticker,Weight
SPY,40
QQQ,30
VTI,30`;

        console.log('Testing bad CSV (missing headers):');
        console.log('Lines:', badCsv.split('\n').length);
        console.log('First line:', badCsv.split('\n')[0]);
        console.log('Expected: Should fail validation');

        console.log('\nTesting good CSV (with headers):');
        console.log('Lines:', goodCsv.split('\n').length);
        console.log('First line:', goodCsv.split('\n')[0]);
        console.log('Expected: Should pass validation');
      }

      // Run test on page load
      testValidation();
    </script>
  </body>
</html>
